{% extends 'basic/base.html' %}
{% block title %}Dashboard{% endblock %}

{% block content %}
<h1>Dashboard</h1>
<p>Welcome, {{ user.username }}!</p>

<!-- Quick Overview Section -->
<h3>Quick Overview of Tests:</h3>
<ul>
  <li>Total Tests: {{ total_tests }}</li>
  <li>Active Tests: {{ active_tests }}</li>
  <li>Pending Tests: {{ pending_tests }}</li>
</ul>

<!-- Filter and Search Section -->
<h4>Filter Tests:</h4>
<form method="GET" action="">
  <label for="start_date">Start Date:</label>
  <input type="date" name="start_date" id="start_date">
  <label for="end_date">End Date:</label>
  <input type="date" name="end_date" id="end_date">
  <button type="submit">Apply Filters</button>
</form>

<!-- Recent Completed Tests Section -->
<h4>Recent Completed Tests (Top 10):</h4>
<ul>
  {% for test in recent_tests %}
    <li>{{ test.date|date:"M d, Y" }} - Accuracy: {{ test.accuracy|floatformat:2 }}%</li>
  {% empty %}
    <li>No recent tests available.</li>
  {% endfor %}
</ul>

<!-- Chart Section -->
{% if scores %}
  <h4>Accuracy Over Past 10 Tests:</h4>
  <canvas id="testGraph"></canvas>
  <style>
    #testGraph {
      max-width: 100%;
      height: auto;
    }
  </style>

  <script id="labels-data" type="application/json">{{ labels|safe }}</script>
  <script id="scores-data" type="application/json">{{ scores|safe }}</script>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const ctx = document.getElementById("testGraph").getContext("2d");

    const labels = JSON.parse(document.getElementById("labels-data").textContent);
    const data = JSON.parse(document.getElementById("scores-data").textContent);

    new Chart(ctx, {
      type: 'bar',
      data: {
        labels: labels,
        datasets: [{
          label: "Test Accuracy (%)",
          data: data,
          backgroundColor: "rgba(54, 162, 235, 0.6)",
          borderColor: "rgba(54, 162, 235, 1)",
          borderWidth: 1,
          borderRadius: 6,
          hoverBackgroundColor: "rgba(54, 162, 235, 0.8)"
        }]
      },
      options: {
        responsive: true,
        plugins: {
          title: {
            display: true,
            text: "Accuracy Over Last 10 Completed Tests"
          },
          tooltip: {
            mode: 'index',
            intersect: false
          }
        },
        scales: {
          y: {
            beginAtZero: true,
            max: 100,
            title: {
              display: true,
              text: "Accuracy (%)"
            }
          },
          x: {
            title: {
              display: true,
              text: "Test Date"
            }
          }
        }
      }
    });
  </script>
{% else %}
  <p>No data available for chart.</p>
{% endif %}

<!-- Export Data Section -->
<h4>Export Data:</h4>
<a href="{% url 'basic:export_test_data' %}" class="btn btn-primary">Export Test Data</a>

<!-- Notifications Section -->
<h4>Notifications:</h4>
<ul>
  <li>You have {{ pending_tests }} tests pending approval.</li>
  <li>{{ upcoming_tests }} tests are scheduled for tomorrow.</li>
</ul>

<!-- Dark Mode Toggle -->
<h4>Dark Mode:</h4>
<button id="darkModeToggle">Toggle Dark Mode</button>
<script>
  document.getElementById('darkModeToggle').addEventListener('click', () => {
    document.body.classList.toggle('dark-mode');
  });
</script>
<style>
  .dark-mode {
    background-color: #121212;
    color: #ffffff;
  }
</style>

{% endblock %}
